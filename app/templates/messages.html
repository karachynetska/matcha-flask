<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="This is social network html5 template available in themeforest......" />
		<meta name="keywords" content="Social Network, Social Media, Make Friends, Newsfeed, Profile Page" />
		<meta name="robots" content="index, follow" />
		<title>Chatroom | Send and Receive Messages</title>

    <!-- Stylesheets
    ================================================= -->
        <link rel="stylesheet" href='{{ url_for('static', filename = 'css/bootstrap.min.css') }}' />
        <link rel="stylesheet" href="{{ url_for('static', filename = 'css/jquery-ui.min.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', filename = 'css/jquery.scrollbar.css') }}" />
		<link rel="stylesheet" href="{{ url_for('static', filename = 'css/style.css') }}" />
		<link rel="stylesheet" href="{{ url_for('static', filename = 'css/ionicons.min.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', filename = 'css/font-awesome.min.css') }}" />
        <link href="{{ url_for('static', filename = 'css/emoji.css') }}" rel="stylesheet">

    <!--Google Font-->
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700,700i" rel="stylesheet">

    <!--Favicon-->
        <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename = 'images/fav.png') }}"/>
	</head>
  <body>

   {% include 'header.html' %}

    <div id="page-contents">
    	<div class="container">
    		<div class="row">

    			<!-- Newsfeed Common Side Bar Left
          ================================================= -->
    			<div class="col-md-3 static">
            <div class="profile-card" style="background: url({{ data.user.background }}) no-repeat; background-size: cover">
            	<img src="{{ data.user.avatar }}" alt="user" class="profile-photo" />
            	<h5><a href="timeline.html" class="text-white">{{ data.user.firstname + ' ' + data.user.lastname }}</a></h5>
            	<a href="#" class="text-white"><i class="ion ion-android-person-add"></i> 1,299 followers</a>
            </div><!--profile card ends-->
            <ul class="nav-news-feed">
              <li><i class="icon ion-ios-paper"></i><div><a href="newsfeed.html">My Newsfeed</a></div></li>
              <li><i class="icon ion-ios-people"></i><div><a href="newsfeed-people-nearby.html">People Nearby</a></div></li>
              <li><i class="icon ion-ios-people-outline"></i><div><a href="newsfeed-friends.html">Friends</a></div></li>
              <li><i class="icon ion-chatboxes"></i><div><a href="newsfeed-messages.html">Messages</a></div></li>
              <li><i class="icon ion-images"></i><div><a href="newsfeed-images.html">Images</a></div></li>
              <li><i class="icon ion-ios-videocam"></i><div><a href="newsfeed-videos.html">Videos</a></div></li>
            </ul><!--news-feed links ends-->
            <div id="chat-block">
              <div class="title">Chat online</div>
              <ul class="online-users list-inline">
                <li><a href="newsfeed-messages.html" title="Linda Lohan"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="Sophia Lee"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="John Doe"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="Alexis Clark"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="James Carter"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="Robert Cook"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="Richard Bell"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="Anna Young"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
                <li><a href="newsfeed-messages.html" title="Julia Cox"><img src="http://placehold.it/300x300" alt="user" class="img-responsive profile-photo" /><span class="online-dot"></span></a></li>
              </ul>
            </div><!--chat block ends-->
          </div>

    			<div class="col-md-9">

            <!-- Chat Room
            ================================================= -->
            <div class="chat-room">
              <div  class="row">
                <div class="col-md-5">
                <ul class="nav nav-tabs contact-list scrollbar-wrapper scrollbar-outer">
                {% if not data.dialogues %}
                <p>You have no dialogues yet</p>
                    {% else %}
                        {% for dialogue in data.dialogues %}
                            {% if session.get('id') == dialogue.id_user1 %}
                            {% set companion = data.get_user_by_id(dialogue.id_user2)[0] %}
                            {% elif session.get('id') == dialogue.id_user2 %}
                            {% set companion = data.get_user_by_id(dialogue.id_user1)[0] %}
                            {% endif %}
                  <!-- Contact List in Left-->

                    <li onclick="init({{ dialogue.id_dialogue }}, {{ session.get('id') }}, {{ companion.id }})">
                    <div class="id_dialogue" style="display: none">{{ dialogue.id_dialogue }}</div>
                    <div class="from_whom_id" style="display: none">{{ session.get('id') }}</div>
                    <div class="to_whom_id" style="display: none">{{ companion.id }}</div>
                      <a href="#contact-{{ dialogue.id_dialogue }}" data-toggle="tab">
                        <div class="contact" id="{{ dialogue.id_dialogue }}">
                        	<img src="{{ companion.avatar }}" alt="" class="profile-photo-sm pull-left"/>
                        	<div class="msg-preview">
                        		<h6>{{ companion.firstname + ' ' + companion.lastname }}</h6>
                                {% set last_message =  data.get_last_message_by_dialogue_id(dialogue.id_dialogue) %}
                                {% if last_message %}
                        		<p class="text-muted" id="last_message">{{ last_message['message'] }}</p>
                                {% else %}
                                <p>There are no messages here yet</p>
                                {% endif %}
                            <small class="text-muted">a min ago</small>
                            {% set unread_messages =  data.get_unread_messages_nbr(companion.id, session.get('id')) %}
                            {% if unread_messages != 0 %}
                                <div class="chat-alert">{{ unread_messages }}</div>
                            {% endif %}
                        	</div>
                        </div>
                      </a>
                    </li>
                            {% endfor %}
                {% endif %}
                  </ul><!--Contact List in Left End-->

                </div>
                <div class="col-md-7">


                  <!--Chat Messages in Right-->
                <div class="tab-content scrollbar-wrapper wrapper scrollbar-outer">
                  {% if data.dialogues %}
                    {% for dialogue in data.dialogues %}
                        {% if session.get('id') == dialogue.id_user1 %}
                            {% set companion = data.get_user_by_id(dialogue.id_user2)[0] %}
                        {% elif session.get('id') == dialogue.id_user2 %}
                            {% set companion = data.get_user_by_id(dialogue.id_user1)[0] %}
                        {% endif %}
                        <div class="tab-pane" id="contact-{{ dialogue.id_dialogue }}">
                            <div class="chat-body">
                                <ul class="chat-message">
                                {% set messages = data.messages(dialogue.id_dialogue) %}
                                                {% if not messages %}
                                <p>There are no messages here yet</p>
                                {% else %}
                                {% for message in messages %}
                                    {% if message.from_whom_id == session.get('id') %}
                                        <li class="right">
                                            <a href="/profile/id{{ data.user.id }}"><img src="{{ data.user.avatar }}" alt="" class="profile-photo-sm pull-right" /></a>
                      			<div class="chat-item">
                              <div class="chat-item-header">
                              	<h5>{{ data.user.firstname + ' ' + data.user.lastname }}</h5>
                              	<small class="text-muted">3 days ago</small>
                              </div>
                              <p>{{ message.message }}</p>
                            </div>
                      		</li>
{#                      		<li class="right">#}
{#                      			<img src="{{ data.user.avatar }}" alt="" class="profile-photo-sm pull-left" />#}
{#                      			<div class="chat-item">#}
{#                              <div class="chat-item-header">#}
{#                              	<h5>{{ data.user.firstname + ' ' + data.user.lastname }}</h5>#}
{#                              	<small class="text-muted">3 days ago</small>#}
{#                              </div>#}
{#                              <p>{{ message.message }}</p>#}
{#                            </div>#}
{#                      		</li>#}
                                    {% else %}
                                        <li class="left">
                                            <a href="/profile/id{{ companion.id }}"><img src="{{ companion.avatar }}" alt="" class="profile-photo-sm pull-left" /></a>
                      			<div class="chat-item">
                              <div class="chat-item-header">
                              	<h5>{{ companion.firstname + ' ' + companion.lastname }}</h5>
                              	<small class="text-muted">3 days ago</small>
                              </div>
                              <p>{{ message.message }}</p>
                            </div>
                      		</li>
                            {% endif %}
                                    {% endfor %}
                        {% endif %}
                      	</ul>
                      </div>
                    </div>
                                  {% endfor %}
                        {% endif %}
                  </div><!--Chat Messages in Right End-->


                  <div class="send-message">
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="Type your message" id="message">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button" id="send_message">Send</button>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>

{#    			<!-- Newsfeed Common Side Bar Right#}
{#          ================================================= -->#}
{#    			<div class="col-md-2 static">#}
{#            <div class="suggestions" id="sticky-sidebar">#}
{#              <h4 class="grey">Who to Follow</h4>#}
{#              <div class="follow-user">#}
{#                <img src="http://placehold.it/300x300" alt="" class="profile-photo-sm pull-left" />#}
{#                <div>#}
{#                  <h5><a href="timeline.html">Diana Amber</a></h5>#}
{#                  <a href="#" class="text-green">Add friend</a>#}
{#                </div>#}
{#              </div>#}
{#              <div class="follow-user">#}
{#                <img src="http://placehold.it/300x300" alt="" class="profile-photo-sm pull-left" />#}
{#                <div>#}
{#                  <h5><a href="timeline.html">Cris Haris</a></h5>#}
{#                  <a href="#" class="text-green">Add friend</a>#}
{#                </div>#}
{#              </div>#}
{#              <div class="follow-user">#}
{#                <img src="http://placehold.it/300x300" alt="" class="profile-photo-sm pull-left" />#}
{#                <div>#}
{#                  <h5><a href="timeline.html">Brian Walton</a></h5>#}
{#                  <a href="#" class="text-green">Add friend</a>#}
{#                </div>#}
{#              </div>#}
{#              <div class="follow-user">#}
{#                <img src="http://placehold.it/300x300" alt="" class="profile-photo-sm pull-left" />#}
{#                <div>#}
{#                  <h5><a href="timeline.html">Olivia Steward</a></h5>#}
{#                  <a href="#" class="text-green">Add friend</a>#}
{#                </div>#}
{#              </div>#}
{#              <div class="follow-user">#}
{#                <img src="http://placehold.it/300x300" alt="" class="profile-photo-sm pull-left" />#}
{#                <div>#}
{#                  <h5><a href="timeline.html">Sophia Page</a></h5>#}
{#                  <a href="#" class="text-green">Add friend</a>#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
    		</div>
    	</div>
    </div>

    <!-- Footer
    ================================================= -->
    <footer id="footer">
      <div class="container">
      	<div class="row">
          <div class="footer-wrapper">
            <div class="col-md-3 col-sm-3">
              <a href=""><img src="images/logo-black.png" alt="" class="footer-logo" /></a>
              <ul class="list-inline social-icons">
              	<li><a href="#"><i class="icon ion-social-facebook"></i></a></li>
              	<li><a href="#"><i class="icon ion-social-twitter"></i></a></li>
              	<li><a href="#"><i class="icon ion-social-googleplus"></i></a></li>
              	<li><a href="#"><i class="icon ion-social-pinterest"></i></a></li>
              	<li><a href="#"><i class="icon ion-social-linkedin"></i></a></li>
              </ul>
            </div>
            <div class="col-md-2 col-sm-2">
              <h5>For individuals</h5>
              <ul class="footer-links">
                <li><a href="">Signup</a></li>
                <li><a href="">login</a></li>
                <li><a href="">Explore</a></li>
                <li><a href="">Finder app</a></li>
                <li><a href="">Features</a></li>
                <li><a href="">Language settings</a></li>
              </ul>
            </div>
            <div class="col-md-2 col-sm-2">
              <h5>For businesses</h5>
              <ul class="footer-links">
                <li><a href="">Business signup</a></li>
                <li><a href="">Business login</a></li>
                <li><a href="">Benefits</a></li>
                <li><a href="">Resources</a></li>
                <li><a href="">Advertise</a></li>
                <li><a href="">Setup</a></li>
              </ul>
            </div>
            <div class="col-md-2 col-sm-2">
              <h5>About</h5>
              <ul class="footer-links">
                <li><a href="">About us</a></li>
                <li><a href="">Contact us</a></li>
                <li><a href="">Privacy Policy</a></li>
                <li><a href="">Terms</a></li>
                <li><a href="">Help</a></li>
              </ul>
            </div>
            <div class="col-md-3 col-sm-3">
              <h5>Contact Us</h5>
              <ul class="contact">
                <li><i class="icon ion-ios-telephone-outline"></i>+1 (234) 222 0754</li>
                <li><i class="icon ion-ios-email-outline"></i>info@thunder-team.com</li>
                <li><i class="icon ion-ios-location-outline"></i>228 Park Ave S NY, USA</li>
              </ul>
            </div>
          </div>
      	</div>
      </div>
      <div class="copyright">
        <p>Thunder Team © 2016. All rights reserved</p>
      </div>
		</footer>

    <!--preloader-->
    <div id="spinner-wrapper">
      <div class="spinner"></div>
    </div>

    <!-- Scripts
    ================================================= -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename = 'js/jquery-3.1.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/jquery-ui.min.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/jquery.sticky-kit.min.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/jquery.scrollbar.min.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/script.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/messages.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/notifications.js') }}"></script>


  </body>
</html>
